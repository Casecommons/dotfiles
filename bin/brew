#!/bin/bash

set -e

[[ -z "$HOMEBREW_PREFIX" ]] && HOMEBREW_PREFIX=/usr/local
[[ -e "$HOMEBREW_PREFIX/bin/brew" ]] || "$HOMEBREW_PREFIX/bin/brew"
homebrew_owner="$(stat -f %u /usr/local/Homebrew)"

if [[ "$homebrew_owner" != "$(id -u)" ]]; then
  exec sudo -Hu "#$homebrew_owner" "$HOMEBREW_PREFIX/bin/brew" "$@"
else
  exec "$HOMEBREW_PREFIX/bin/brew" "$@"
fi
